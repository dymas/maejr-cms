<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <link rel="shortcut icon" href="/assets/imagens/favicon.ico" type="image/x-icon">
  <meta name="theme-color" content="#0a1e3a">
  <title>Administração</title>
</head>

<body>
  <!-- Include the script that builds the page and powers Netlify CMS -->
  <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>

  <script>
    CMS.registerEditorComponent({
      id: "blocoazul",
      label: "Bloco Azul",
      fields: [
        {
          label: 'Título do bloco',
          name: 'titulobloco',
          widget: 'string'
        },
        {
          label: 'Texto do bloco',
          name: 'textobloco',
          widget: 'string'
        },
        {
          label: "Ícone",
          name: "iconebloco",
          widget: "select",
          options: ["Universidade"],
          required: false
        }
      ],
      pattern: /^<section class="bloco" id="(.*)"><h2>(.*)<\/h2><p>(.*)<\/p><p>(.*)<\/p><\/section>*$/,
      fromBlock: function (match) {
        return {
          titulobloco: match[1],
          textobloco: match[3],
          iconebloco: match[4]
        };
      },
      toBlock: function (obj) {
        return '<section class="bloco" id="' + obj.titulobloco + '"><h2>' + obj.titulobloco + '</h2><p>' + obj.textobloco + '</p><p>' + obj.iconebloco + '</p></section>';
      },
      toPreview: function (obj) {
        return (
          '<section class="bloco" id="' + obj.titulobloco + '"><h2>' + obj.titulobloco + '</h2><p>' + obj.textobloco + '</p><p>' + obj.iconebloco + '</p></section>'
        );
      }
    });
  </script>

  <script>
    CMS.registerEditorComponent({
      id: "nuvem",
      label: "Nuvem",
      fields: [
        {
          label: 'Lista de Itens',
          name: 'listanuvem',
          widget: 'list',
          label_singular: 'Item',
          min: 2,
          max: 6,
          fields: [
            {
              label: 'Ícone do item',
              name: 'iconenuvem',
              widget: 'select',
              options: ['Teste 1', 'Teste 2']
            },
            {
              label: 'Título do item',
              name: 'titulonuvem',
              widget: 'string'
            },
            {
              label: 'Texto do item',
              name: 'textonuvem',
              widget: 'string'
            }
          ]
        }
      ],
      pattern: /^{% assign array = "(.*?)" \| split: ", " %} {% include nuvem.html %}*$/,
      fromBlock: function (match) {
        var listanuvem = [];
        var origem = match[1].split(",");
        console.log(origem);
        var [num1, num2, num3] = [0, 1, 2];
        for (var item in origem) {
          if (origem.length === num1) {
            return listanuvem;
            break;
          }
          var [icone, titulo, texto] = [origem[num1], origem[num2], origem[num3]];
          listanuvem.push({
            iconenuvem: icone,
            titulonuvem: titulo,
            textonuvem: texto
          });
          num1 = num3 + 1;
          num2 = num3 + 2;
          num3 = num3 + 3;
        }
        return listanuvem;
      },
      toBlock: function (obj) {
        if (obj.listanuvem !== undefined) {
          var arraylistanuvem = [];
          for (var item in obj.listanuvem) {
            arraylistanuvem.push(obj.listanuvem[item].iconenuvem, obj.listanuvem[item].titulonuvem, obj.listanuvem[item].textonuvem);
          }
        }
        if (arraylistanuvem) {
          return '{% assign array = "' + arraylistanuvem.join() + '" | split: ", " %} {% include nuvem.html %}';
        }
      },
      toPreview: function (obj) {
        return (
          ''
        );
      }
    });
  </script>
</body>

</html>